name: OnPushNewVersion

on:
  push:
    #branches: [ master ]  
    tags:
    - 'v*'

  # Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:

jobs:

  build:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v2
   
      - name: Pull project 
        run: |
          mkdir installDist
          tar -czvf ./installDist/stserver-install.tar.gz ./install         
          ls -la ./installDist/
        
      - name: ðŸ“‚ Upload install to FTP
        uses: SamKirkland/FTP-Deploy-Action@4.1.0
        with:
          server: ftp.impleotv.com
          username: impleocontent@impleotv.com
          password: ${{ secrets.FTP_IMPLEO_CONTENT }}
          local-dir: ./installDist/
          server-dir: stserver2/setup/
   
      - name: Upload to github Release
        uses: svenstaro/upload-release-action@v2
        with:
          repo_token: ${{ secrets.REPO_TOKEN }}
          file: ./installDist/stserver-install.tar.gz
          asset_name: stserver-install.tar.gz
          tag: ${{ github.ref }}
          overwrite: true
          body: "stserver-install"

      # - name: Build mcdocs      
      #   uses: Tiryoh/actions-mkdocs@v0
      #   with:
      #     mkdocs_version: 'latest' # option
      #     configfile: './Doc/stserverdoc/mkdocs.yml' 

      # - name: Show doc 
      #   run: |
      #     ls -la ./Doc/stserverdoc/site/

      # - name: Upload docs to FTP
      #   uses: SamKirkland/FTP-Deploy-Action@4.1.0
      #   with:
      #     server: ftp.impleotv.com
      #     username: impleocontent@impleotv.com
      #     password: ${{ secrets.FTP_IMPLEO_CONTENT }}
      #     local-dir: ./Doc/stserverdoc/site/
      #     server-dir: stserver2/help/
